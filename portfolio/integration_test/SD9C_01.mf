;========================================================================
; Integration Test for SD9C
;========================================================================
;18649 Fall 2012
;Group17
;Collin Buchan (cbuchan)
;Rajeev Sharma (rdsharma)
;Jesse Salazar (jessesal)
;Jessica Tiu   (jtiu) - Author
;
;Last modified 2012-10-11 (cbuchan)
;========================================================================

#INCLUDE defines.mf ;include CAN id and period definitions

;========================================================================
;initialize
;========================================================================
;Elevator approaching floor f, with doors closed.
; DoorControl in closed state
+0s I  DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[BACK][LEFT]_CAN_ID DoorClosed BACK LEFT = true
+0s I  DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[BACK][RIGHT]_CAN_ID DoorClosed BACK RIGHT = true
+0s I  DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = true
+0s I  DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][RIGHT]_CAN_ID DoorClosed FRONT RIGHT = true

;========================================================================
;1. Elevator arrives at floor f.
;========================================================================

; arc1. mAtFloor[f,*]=true
+0.5s I AT_FLOOR_PERIOD N AT_FLOOR_[1][FRONT]_CAN_ID AtFloor 1 FRONT = true
+0s   I AT_FLOOR_PERIOD N AT_FLOOR_[1][BACK]_CAN_ID AtFloor 1 BACK = true

+0s  I HALL_BUTTON_CONTROL_PERIOD F HallCall 7 FRONT DOWN  = true
+0s  I HALL_BUTTON_CONTROL_PERIOD F HallCall 7 BACK DOWN  = true

;========================================================================
;2. Dispatcher notifies DoorControl that Both doors should be opened.
;========================================================================
; arc2. assert desired floor.b=both <-- Dispatcher
+0.5s A N DESIRED_FLOOR_CAN_ID DesiredFloor : getFloor == 1
+0s   A N DESIRED_FLOOR_CAN_ID DesiredFloor : getHallway == BOTH
+0s   A N DESIRED_FLOOR_CAN_ID DesiredFloor : getDirection == UP

;========================================================================
;3. Both doors open.
;========================================================================
; arc3. assert DoorMotor[b,*]=open <-- DoorControl
+0.5s A F DoorMotor FRONT RIGHT : command == OPEN
+0s   A F DoorMotor FRONT LEFT : command == OPEN
+0s   A F DoorMotor BACK RIGHT : command == OPEN
+0s   A F DoorMotor BACK LEFT : command == OPEN

; arc4. mDoorOpened[*,r]=true
+0.5s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][RIGHT]_CAN_ID DoorOpened FRONT RIGHT = true
+0s   I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = true
+0s   I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[BACK][RIGHT]_CAN_ID DoorOpened BACK RIGHT = true
+0s   I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[BACK][LEFT]_CAN_ID DoorOpened BACK LEFT = true

; arc5. assert DoorMotor[b,*]=stop <-- DoorControl
+0.5s A F DoorMotor FRONT RIGHT : command == STOP
+0s   A F DoorMotor FRONT LEFT : command == STOP
+0s   A F DoorMotor BACK RIGHT : command == STOP
+0s   A F DoorMotor BACK LEFT : command == STOP

;========================================================================
;Post Conditions
;========================================================================
;Both doors are open.
;Elevator is at floor f.

