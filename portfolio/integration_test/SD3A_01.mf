;========================================================================
; Integration Test for SD3A
;========================================================================
;18649 Fall 2012
;Group17
;Collin Buchan (cbuchan) - Author
;Rajeev Sharma (rdsharma)
;Jesse Salazar (jessesal)
;Jessica Tiu   (jtiu)
;
;Last modified 2012-10-11 (rdsharma)
;========================================================================

#INCLUDE defines.mf ;include CAN id and period definitions

;========================================================================
;initialize
;========================================================================
;Car is about to arrive at hallway [4,FRONT] where passenger is waiting
;HallCall[4,UP] has been pressed
;Elevator is going in direction UP
;Passenger is outside car, doors are closed
0s     I  DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = true
+0s    I  DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][RIGHT]_CAN_ID DoorClosed FRONT RIGHT = true
+0s    I  DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[BACK][LEFT]_CAN_ID DoorClosed BACK LEFT = true
+0s    I  DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[BACK][RIGHT]_CAN_ID DoorClosed BACK RIGHT = true
+0s    I  WEIGHT_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 100
;Need to set DesiredDwell or DoorControl will oscillate once open
+0s    I DOOR_CONTROL_PERIOD N DESIRED_DWELL_[FRONT]_CAN_ID DesiredDwell FRONT = 10
+0s    I DOOR_CONTROL_PERIOD N DESIRED_DWELL_[BACK]_CAN_ID DesiredDwell BACK = 10
;Need to set a starting AtFloor so that DriveControl can compute DesiredDir and transition to DRIVE_SLOW
+0s    I  AT_FLOOR_PERIOD N AT_FLOOR_[3][FRONT]_CAN_ID AtFloor 3 FRONT = true

+0.10s  I  HALL_BUTTON_CONTROL_PERIOD N HALL_CALL_[4][FRONT][UP]_CAN_ID Boolean = true
+0.10s  I DISPATCHER_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 4 FRONT STOP

; wait for Dispatcher to set direction

+0.10s I  AT_FLOOR_PERIOD N AT_FLOOR_[3][FRONT]_CAN_ID AtFloor 3 FRONT = false


;========================================================================
;Scenario Step 1
;========================================================================
;Arcs 1a-c
+1.00s I  AT_FLOOR_PERIOD N AT_FLOOR_[4][FRONT]_CAN_ID AtFloor 4 FRONT = true
+0s    I  LEVEL_SENSOR_PERIOD N LEVEL_SENSOR_[UP]_CAN_ID Leveling UP = true

;Arc 1d
+0.41s A  F Drive : speed == LEVEL
+0s    A  F Drive : direction == UP

;Arc 1e
+0.79s I  LEVEL_SENSOR_PERIOD N LEVEL_SENSOR_[DOWN]_CAN_ID Leveling DOWN = true

;Arc 1f
+0.30s A  F Drive : speed == STOP

;========================================================================
;Scenario Step 2
;========================================================================
;Arc 2a
+0.21s A  F DoorMotor FRONT LEFT : command == OPEN

;Arc 2b
+0.59s I  DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = false

;========================================================================
;Scenario Step 3
;========================================================================
;Arc 3
+0.21s A F HallLight 4 FRONT UP : lighted == false

;========================================================================
;Scenario Step 4
;========================================================================
;Arc 4a
+0.79s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = true

;Arc 4b
+0.41s A  F DoorMotor FRONT LEFT : command == STOP

;========================================================================
;Scenario Step 5
;========================================================================
;Arc 5a (Passenger sees door open)
;Arc 5b (Passenger enters)
